#!/usr/bin/env bash

# Function to log errors
log_error() {
  echo "❌ $1" >&2
}

# Function to log status messages
log_status() {
  echo "ℹ️  $1"
}

# Function to set up Poetry layout
layout_poetry() {
  if [[ ! -f pyproject.toml ]]; then
    log_error 'No pyproject.toml found. Use `poetry new` or `poetry init` to create one first.'
    exit 2
  fi

  local VENV
  VENV=$(poetry env info --path 2>/dev/null)
  if [[ -z $VENV || ! -d $VENV/bin ]]; then
    log_status 'No Poetry virtual environment found. Creating one.'
    poetry install
    VENV=$(poetry env info --path)
  fi

  export VIRTUAL_ENV="$VENV"
  export POETRY_ACTIVE=1
  PATH_add "$VENV/bin"
}

# Check if Poetry is installed
if ! command -v poetry >/dev/null 2>&1; then
  log_error "Poetry is not installed. Please install it first."
  exit 2
fi

# Set up the Poetry environment
layout_poetry

# Project-specific environment variables can be set here
export PROJECT_NAME="glorious"
export DEBUG=true

# You can add more project-specific logic or variable exports here

# log_status "Poetry environment activated for $PROJECT_NAME"
